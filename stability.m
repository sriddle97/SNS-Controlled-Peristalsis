% Stability analysis

clear; clc;

% unperturbed initial condition
Usim10 = [-12.006871117836758,-0.037569045159630,20.039767445130014,-12.004125112282729,-12.004072551951722,-12.004223349748708];
Usim20 = [33.126377774293190,20.021074321835480,-0.083650004350695,33.123007659020030,33.123330459106940,33.123813860304480];
Usim30 = [19.999999999999993,-1.213572855380459e-43,-13.293589611813474,19.999999999999993,19.999999999999993,19.999999999999993];
Usim40 = [-0.066357681585740,19.910709703905162,3.956262823290665e-48,-0.066357681585739,-0.066357681585740,-0.066357681585740];
hSim10 = [0.784291412484489,0.665173770738992,0.424438410403847,0.784473186159200,0.784476665050503,0.784466683927494];
hSim20 = [0.276516290758568,0.424177423758153,0.663831280837606,0.276452924831873,0.276458994201382,0.276468083239984];
h0 = [10.999987920459224,10.964792168986495,6.545349085525793,10.999962938489155,10.999999999998577,10.999999995855607];
Isens0 = [20,0,0,20,20,20];

INITIAL_U = [Usim10 Usim20 Usim30 Usim40 hSim10 hSim20 h0];

T = 5250; %period

% perturbed initial condition
epsilon = 0.001;
V = zeros(42,42);
for i = 1:36
    pert = zeros(1,42);
    pert(i) = epsilon;
    INITIAL_P = INITIAL_U-pert;
    FINAL_P = Riddle_cycle_new(INITIAL_P,Isens0,T);
    V(:,i) = -(FINAL_P'-INITIAL_U')/epsilon;
end

% Floquet multipliers
[evec,eval] = eigs(V)